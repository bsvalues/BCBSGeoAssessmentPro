{% extends 'layout.html' %}

{% block styles %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
<link rel="stylesheet" href="{{ url_for('static', filename='css/map.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/assessment.css') }}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-3">
        <div class="col-12">
            <h1><i class="fas fa-map-marked-alt me-2"></i> GeoAssessmentPro</h1>
            <p class="lead">Benton County Property Assessment and Valuation Platform</p>
        </div>
    </div>
    
    <!-- Key metrics cards -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                Total Properties</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">8,245</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-home fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                2025 Assessment Total</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">$4.2B</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Assessment Progress</div>
                            <div class="row no-gutters align-items-center">
                                <div class="col-auto">
                                    <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800">78%</div>
                                </div>
                                <div class="col">
                                    <div class="progress progress-sm mr-2">
                                        <div class="progress-bar bg-info" role="progressbar"
                                            style="width: 78%" aria-valuenow="78" aria-valuemin="0"
                                            aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Review Requests</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">18</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-comments fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-9 mb-4">
            <div class="card">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs" id="mapTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="properties-tab" data-bs-toggle="tab" data-bs-target="#properties" type="button" role="tab" aria-controls="properties" aria-selected="true">
                                <i class="fas fa-map-marker-alt me-1"></i> Properties
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="heatmap-tab" data-bs-toggle="tab" data-bs-target="#heatmap" type="button" role="tab" aria-controls="heatmap" aria-selected="false">
                                <i class="fas fa-fire me-1"></i> Valuation Heatmap
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="zones-tab" data-bs-toggle="tab" data-bs-target="#zones" type="button" role="tab" aria-controls="zones" aria-selected="false">
                                <i class="fas fa-layer-group me-1"></i> Zoning
                            </button>
                        </li>
                    </ul>
                </div>
                <div class="card-body p-0">
                    <div class="tab-content" id="mapTabsContent">
                        <div class="tab-pane fade show active" id="properties" role="tabpanel" aria-labelledby="properties-tab">
                            <!-- Map container for properties view -->
                            <div id="map-properties" class="map-container"></div>
                        </div>
                        <div class="tab-pane fade" id="heatmap" role="tabpanel" aria-labelledby="heatmap-tab">
                            <!-- Map container for heatmap view -->
                            <div id="map-heatmap" class="map-container"></div>
                        </div>
                        <div class="tab-pane fade" id="zones" role="tabpanel" aria-labelledby="zones-tab">
                            <!-- Map container for zoning view -->
                            <div id="map-zones" class="map-container"></div>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="d-flex justify-content-between align-items-center">
                        <div id="map-coordinates" class="map-coordinates">
                            Lat: 0.000000, Long: 0.000000
                        </div>
                        <div class="map-layers-info">
                            <span class="badge bg-secondary">
                                <i class="fas fa-layer-group me-1"></i>
                                Layers: <span id="layer-count">0</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Map alerts container -->
            <div id="map-alerts" class="mt-2"></div>
        </div>
        
        <div class="col-md-3">
            <!-- Assessment Tools Panel -->
            <div class="assessment-sidebar">
                <!-- Property filter card -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-filter me-2"></i> Property Filters
                        </h5>
                    </div>
                    <div class="card-body">
                        <form id="property-filter-form">
                            <div class="mb-3">
                                <label for="property-type" class="form-label">Property Type</label>
                                <select id="property-type" class="form-select">
                                    <option value="all">All Types</option>
                                    <option value="residential">Residential</option>
                                    <option value="commercial">Commercial</option>
                                    <option value="agricultural">Agricultural</option>
                                    <option value="industrial">Industrial</option>
                                    <option value="public">Public/Government</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="assessment-year" class="form-label">Assessment Year</label>
                                <select id="assessment-year" class="form-select">
                                    <option value="2025">2025</option>
                                    <option value="2024">2024</option>
                                    <option value="2023">2023</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="value-range" class="form-label">Value Range</label>
                                <div class="d-flex">
                                    <input type="number" id="min-value" class="form-control me-2" placeholder="Min">
                                    <input type="number" id="max-value" class="form-control" placeholder="Max">
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-search me-2"></i> Apply Filters
                                </button>
                                <button type="reset" class="btn btn-outline-secondary">
                                    <i class="fas fa-undo me-2"></i> Reset
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Selected property details card -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-info-circle me-2"></i> Property Details
                        </h5>
                    </div>
                    <div class="card-body" id="property-details">
                        <div class="text-center py-3">
                            <i class="fas fa-home fa-3x text-muted mb-3"></i>
                            <p class="text-muted">Select a property on the map to view details</p>
                        </div>
                    </div>
                </div>
                
                <!-- Analysis tools card -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-chart-line me-2"></i> Analysis Tools
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button id="btn-valuation-trends" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-chart-line me-2"></i> Valuation Trends
                            </button>
                            <button id="btn-comparable-properties" class="btn btn-outline-info btn-sm">
                                <i class="fas fa-search-location me-2"></i> Find Comparable Properties
                            </button>
                            <button id="btn-export-selection" class="btn btn-outline-success btn-sm">
                                <i class="fas fa-file-export me-2"></i> Export Selected Area
                            </button>
                            <button id="btn-print-map" class="btn btn-outline-secondary btn-sm">
                                <i class="fas fa-print me-2"></i> Print Current View
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Property analytics row -->
    <div class="row mt-4">
        <div class="col-lg-8 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Assessment Value by Property Type</h6>
                    <div class="dropdown no-arrow">
                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                            data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                            aria-labelledby="dropdownMenuLink">
                            <div class="dropdown-header">Export Options:</div>
                            <a class="dropdown-item" href="#">Export as PNG</a>
                            <a class="dropdown-item" href="#">Export as PDF</a>
                            <a class="dropdown-item" href="#">Export Data to CSV</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#">View Full Report</a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-area">
                        <canvas id="propertyTypeChart" style="width: 100%; height: 300px;"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Value Distribution</h6>
                </div>
                <div class="card-body">
                    <div class="chart-pie pt-2">
                        <canvas id="propertyDistributionChart" style="width: 100%; height: 300px;"></canvas>
                    </div>
                </div>
                <div class="card-footer small text-muted">
                    Updated as of April 16, 2025
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Property Detail Modal -->
<div class="modal fade" id="property-detail-modal" tabindex="-1" aria-labelledby="propertyDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="propertyDetailModalLabel">Property Detail</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="property-detail-content">
                <!-- Property details will be loaded here -->
                <div class="text-center p-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3">Loading property details...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="btn-edit-property">Edit Property</button>
                <button type="button" class="btn btn-success" id="btn-export-property">Export Details</button>
            </div>
        </div>
    </div>
</div>

<!-- Export Selection Modal -->
<div class="modal fade" id="export-modal" tabindex="-1" aria-labelledby="exportModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exportModalLabel">Export Data</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="export-filename" class="form-label">Filename</label>
                    <input type="text" class="form-control" id="export-filename" value="benton-county-assessment">
                </div>
                <div class="mb-3">
                    <label for="export-format" class="form-label">Format</label>
                    <select id="export-format" class="form-select">
                        <option value="csv">CSV Spreadsheet</option>
                        <option value="xlsx">Excel Spreadsheet</option>
                        <option value="pdf">PDF Report</option>
                        <option value="geojson">GeoJSON</option>
                        <option value="shapefile">Shapefile</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="export-data" class="form-label">Data to Include</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="basic" id="check-basic-info" checked>
                        <label class="form-check-label" for="check-basic-info">
                            Basic Property Information
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="valuation" id="check-valuation" checked>
                        <label class="form-check-label" for="check-valuation">
                            Valuation History
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="spatial" id="check-spatial" checked>
                        <label class="form-check-label" for="check-spatial">
                            Spatial Data
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="tax" id="check-tax">
                        <label class="form-check-label" for="check-tax">
                            Tax Information
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="export-confirm-btn">Export</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet-heatmap@1.0.0/leaflet-heatmap.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- GeoAssessmentPro Scripts -->
<script src="{{ url_for('static', filename='js/map.js') }}"></script>
<script src="{{ url_for('static', filename='js/assessment_map.js') }}"></script>
{% endblock %}