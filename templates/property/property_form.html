{% extends "layout.html" %}

{% block title %}{% if property.id %}Edit{% else %}New{% endif %} Property - GeoAssessmentPro{% endblock %}

{% block additionalcss %}
<style>
    .form-section {
        background-color: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .section-title {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: #495057;
    }
    
    .form-label {
        font-weight: 500;
    }
    
    .required-field::after {
        content: "*";
        color: #dc3545;
        margin-left: 4px;
    }
    
    .form-text {
        font-size: 0.8rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Breadcrumb Navigation -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Home</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('property.property_list') }}">Properties</a></li>
            <li class="breadcrumb-item active" aria-current="page">
                {% if property.id %}Edit Property{% else %}New Property{% endif %}
            </li>
        </ol>
    </nav>
    
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col">
            <h1 class="display-5">
                <i class="fas {% if property.id %}fa-edit{% else %}fa-plus-circle{% endif %} me-2"></i>
                {% if property.id %}Edit{% else %}Create{% endif %} Property
            </h1>
            <p class="lead text-muted">
                {% if property.id %}
                Update property information for Parcel ID: {{ property.parcel_id }}
                {% else %}
                Add a new property to the system
                {% endif %}
            </p>
        </div>
    </div>
    
    <!-- Property Form -->
    <form method="post" id="property-form">
        {% if property.id %}
        <input type="hidden" name="id" value="{{ property.id }}">
        {% endif %}
        
        <!-- Basic Information Section -->
        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-info-circle me-2"></i> Basic Information
            </h2>
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="parcel_id" class="form-label required-field">Parcel ID</label>
                    <input type="text" class="form-control" id="parcel_id" name="parcel_id" 
                           value="{{ property.parcel_id or '' }}" required>
                    <div class="form-text">Unique identifier for the property</div>
                </div>
                
                <div class="col-md-6">
                    <label for="account_number" class="form-label">Account Number</label>
                    <input type="text" class="form-control" id="account_number" name="account_number" 
                           value="{{ property.account_number or '' }}">
                </div>
                
                <div class="col-md-6">
                    <label for="property_class" class="form-label">Property Class</label>
                    <select class="form-select" id="property_class" name="property_class">
                        <option value="" {% if not property.property_class %}selected{% endif %}>Select Property Class</option>
                        <option value="residential" {% if property.property_class == 'residential' %}selected{% endif %}>Residential</option>
                        <option value="commercial" {% if property.property_class == 'commercial' %}selected{% endif %}>Commercial</option>
                        <option value="agricultural" {% if property.property_class == 'agricultural' %}selected{% endif %}>Agricultural</option>
                        <option value="industrial" {% if property.property_class == 'industrial' %}selected{% endif %}>Industrial</option>
                        <option value="vacant" {% if property.property_class == 'vacant' %}selected{% endif %}>Vacant</option>
                    </select>
                </div>
                
                <div class="col-md-6">
                    <label for="zoning" class="form-label">Zoning</label>
                    <input type="text" class="form-control" id="zoning" name="zoning" 
                           value="{{ property.zoning or '' }}">
                </div>
                
                <div class="col-md-6">
                    <label for="status" class="form-label">Status</label>
                    <select class="form-select" id="status" name="status">
                        <option value="active" {% if property.status == 'active' or not property.status %}selected{% endif %}>Active</option>
                        <option value="inactive" {% if property.status == 'inactive' %}selected{% endif %}>Inactive</option>
                        <option value="pending" {% if property.status == 'pending' %}selected{% endif %}>Pending</option>
                    </select>
                </div>
                
                <div class="col-md-12">
                    <label for="legal_description" class="form-label">Legal Description</label>
                    <textarea class="form-control" id="legal_description" name="legal_description" rows="3">{{ property.legal_description or '' }}</textarea>
                </div>
            </div>
        </div>
        
        <!-- Location Section -->
        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-map-marker-alt me-2"></i> Location
            </h2>
            <div class="row g-3">
                <div class="col-md-12">
                    <label for="address" class="form-label">Street Address</label>
                    <input type="text" class="form-control" id="address" name="address" 
                           value="{{ property.address or '' }}">
                </div>
                
                <div class="col-md-5">
                    <label for="city" class="form-label">City</label>
                    <input type="text" class="form-control" id="city" name="city" 
                           value="{{ property.city or '' }}">
                </div>
                
                <div class="col-md-3">
                    <label for="state" class="form-label">State</label>
                    <input type="text" class="form-control" id="state" name="state" 
                           value="{{ property.state or 'WA' }}">
                </div>
                
                <div class="col-md-4">
                    <label for="zip_code" class="form-label">ZIP Code</label>
                    <input type="text" class="form-control" id="zip_code" name="zip_code" 
                           value="{{ property.zip_code or '' }}">
                </div>
                
                <div class="col-md-6">
                    <label for="latitude" class="form-label">Latitude</label>
                    <input type="number" step="any" class="form-control" id="latitude" name="latitude" 
                           value="{{ property.latitude or '' }}">
                </div>
                
                <div class="col-md-6">
                    <label for="longitude" class="form-label">Longitude</label>
                    <input type="number" step="any" class="form-control" id="longitude" name="longitude" 
                           value="{{ property.longitude or '' }}">
                </div>
            </div>
        </div>
        
        <!-- Property Characteristics Section -->
        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-home me-2"></i> Property Characteristics
            </h2>
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="land_area" class="form-label">Land Area (sq ft)</label>
                    <input type="number" step="0.01" class="form-control" id="land_area" name="land_area" 
                           value="{{ property.land_area or '' }}">
                </div>
                
                <div class="col-md-4">
                    <label for="lot_size" class="form-label">Lot Size (acres)</label>
                    <input type="number" step="0.01" class="form-control" id="lot_size" name="lot_size" 
                           value="{{ property.lot_size or '' }}">
                </div>
                
                <div class="col-md-4">
                    <label for="year_built" class="form-label">Year Built</label>
                    <input type="number" class="form-control" id="year_built" name="year_built" 
                           value="{{ property.year_built or '' }}">
                </div>
                
                <div class="col-md-4">
                    <label for="living_area" class="form-label">Living Area (sq ft)</label>
                    <input type="number" step="0.01" class="form-control" id="living_area" name="living_area" 
                           value="{{ property.living_area or '' }}">
                </div>
                
                <div class="col-md-4">
                    <label for="bedrooms" class="form-label">Bedrooms</label>
                    <input type="number" class="form-control" id="bedrooms" name="bedrooms" 
                           value="{{ property.bedrooms or '' }}">
                </div>
                
                <div class="col-md-4">
                    <label for="bathrooms" class="form-label">Bathrooms</label>
                    <input type="number" step="0.5" class="form-control" id="bathrooms" name="bathrooms" 
                           value="{{ property.bathrooms or '' }}">
                </div>
            </div>
        </div>
        
        <!-- Valuation Section -->
        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-dollar-sign me-2"></i> Valuation
            </h2>
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="land_value" class="form-label">Land Value ($)</label>
                    <input type="number" step="0.01" class="form-control" id="land_value" name="land_value" 
                           value="{{ property.land_value or '' }}">
                </div>
                
                <div class="col-md-4">
                    <label for="improvement_value" class="form-label">Improvement Value ($)</label>
                    <input type="number" step="0.01" class="form-control" id="improvement_value" name="improvement_value" 
                           value="{{ property.improvement_value or '' }}">
                </div>
                
                <div class="col-md-4">
                    <label for="total_value" class="form-label">Total Value ($)</label>
                    <input type="number" step="0.01" class="form-control" id="total_value" name="total_value" 
                           value="{{ property.total_value or '' }}" readonly>
                    <div class="form-text">Automatically calculated from land and improvement values</div>
                </div>
            </div>
        </div>
        
        <!-- Owner Information Section -->
        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-user me-2"></i> Owner Information
            </h2>
            <div class="row g-3">
                <div class="col-md-12">
                    <label for="owner_name" class="form-label">Owner Name</label>
                    <input type="text" class="form-control" id="owner_name" name="owner_name" 
                           value="{{ property.owner_name or '' }}">
                </div>
                
                <div class="col-md-12">
                    <label for="owner_address" class="form-label">Owner Address</label>
                    <input type="text" class="form-control" id="owner_address" name="owner_address" 
                           value="{{ property.owner_address or '' }}">
                </div>
                
                <div class="col-md-5">
                    <label for="owner_city" class="form-label">Owner City</label>
                    <input type="text" class="form-control" id="owner_city" name="owner_city" 
                           value="{{ property.owner_city or '' }}">
                </div>
                
                <div class="col-md-3">
                    <label for="owner_state" class="form-label">Owner State</label>
                    <input type="text" class="form-control" id="owner_state" name="owner_state" 
                           value="{{ property.owner_state or '' }}">
                </div>
                
                <div class="col-md-4">
                    <label for="owner_zip" class="form-label">Owner ZIP</label>
                    <input type="text" class="form-control" id="owner_zip" name="owner_zip" 
                           value="{{ property.owner_zip or '' }}">
                </div>
            </div>
        </div>
        
        <!-- Sale Information Section -->
        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-history me-2"></i> Last Sale Information
            </h2>
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="last_sale_date" class="form-label">Last Sale Date</label>
                    <input type="date" class="form-control" id="last_sale_date" name="last_sale_date" 
                           value="{{ property.last_sale_date or '' }}">
                </div>
                
                <div class="col-md-4">
                    <label for="last_sale_price" class="form-label">Last Sale Price ($)</label>
                    <input type="number" step="0.01" class="form-control" id="last_sale_price" name="last_sale_price" 
                           value="{{ property.last_sale_price or '' }}">
                </div>
                
                <div class="col-md-4">
                    <label for="last_sale_document" class="form-label">Sale Document #</label>
                    <input type="text" class="form-control" id="last_sale_document" name="last_sale_document" 
                           value="{{ property.last_sale_document or '' }}">
                </div>
            </div>
        </div>
        
        <!-- Form Actions -->
        <div class="d-flex justify-content-between mb-5">
            <a href="{{ url_for('property.property_list') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i> Cancel
            </a>
            
            <div>
                <button type="reset" class="btn btn-outline-warning me-2">
                    <i class="fas fa-undo me-1"></i> Reset
                </button>
                
                <button type="submit" class="btn btn-primary">
                    <i class="fas {% if property.id %}fa-save{% else %}fa-plus-circle{% endif %} me-1"></i>
                    {% if property.id %}Update{% else %}Create{% endif %} Property
                </button>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Calculate total value when land or improvement values change
        const landValueInput = document.getElementById('land_value');
        const improvementValueInput = document.getElementById('improvement_value');
        const totalValueInput = document.getElementById('total_value');
        
        function calculateTotalValue() {
            const landValue = parseFloat(landValueInput.value) || 0;
            const improvementValue = parseFloat(improvementValueInput.value) || 0;
            totalValueInput.value = (landValue + improvementValue).toFixed(2);
        }
        
        landValueInput.addEventListener('input', calculateTotalValue);
        improvementValueInput.addEventListener('input', calculateTotalValue);
        
        // Initial calculation
        calculateTotalValue();
        
        // Form validation
        const form = document.getElementById('property-form');
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            form.classList.add('was-validated');
        });
    });
</script>
{% endblock %}