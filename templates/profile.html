{% extends "base.html" %}

{% block title %}User Profile{% endblock %}

{% block content %}
<div class="container my-5">
  <div class="row">
    <div class="col-md-4">
      <div class="card shadow mb-4">
        <div class="card-header bg-primary text-white">
          <h3 class="mb-0">Profile</h3>
        </div>
        <div class="card-body">
          {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
              {% endfor %}
            {% endif %}
          {% endwith %}
          
          <div class="text-center mb-4">
            <div class="avatar-placeholder rounded-circle bg-secondary d-flex align-items-center justify-content-center mb-3 mx-auto" style="width: 100px; height: 100px;">
              <span class="text-white display-4">{{ user.full_name[0]|upper if user.full_name else user.email[0]|upper }}</span>
            </div>
            <h4>{{ user.full_name }}</h4>
            <p class="text-muted">{{ user.email }}</p>
          </div>
          
          <div class="mb-3">
            <strong>Department:</strong>
            <p>{{ user.department or 'Not specified' }}</p>
          </div>
          
          <div class="mb-3">
            <strong>Member since:</strong>
            <p>{{ user.created_at|datetime if user.created_at else 'Unknown' }}</p>
          </div>
          
          <div class="mb-3">
            <strong>Last login:</strong>
            <p>{{ user.last_sign_in_at|datetime if user.last_sign_in_at else 'Never' }}</p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-8">
      <div class="card shadow mb-4">
        <div class="card-header bg-primary text-white">
          <h3 class="mb-0">Roles and Permissions</h3>
        </div>
        <div class="card-body">
          <h5>Your Roles:</h5>
          <ul class="list-group mb-4">
            {% if roles %}
              {% for role in roles %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  {{ role }}
                  <span class="badge bg-primary rounded-pill">Active</span>
                </li>
              {% endfor %}
            {% else %}
              <li class="list-group-item">No roles assigned</li>
            {% endif %}
          </ul>
          
          <h5>What you can do:</h5>
          <div class="card">
            <ul class="list-group list-group-flush">
              {% if 'admin' in roles %}
                <li class="list-group-item">
                  <i class="bi bi-check-circle-fill text-success me-2"></i>
                  Full administrative access to all system functions
                </li>
                <li class="list-group-item">
                  <i class="bi bi-check-circle-fill text-success me-2"></i>
                  Manage users and assign roles
                </li>
                <li class="list-group-item">
                  <i class="bi bi-check-circle-fill text-success me-2"></i>
                  Configure system settings
                </li>
              {% endif %}
              
              {% if 'data_setup' in roles %}
                <li class="list-group-item">
                  <i class="bi bi-check-circle-fill text-success me-2"></i>
                  Create and manage data connections
                </li>
                <li class="list-group-item">
                  <i class="bi bi-check-circle-fill text-success me-2"></i>
                  Configure data mapping and integration
                </li>
              {% endif %}
              
              {% if 'mobile_assessor' in roles %}
                <li class="list-group-item">
                  <i class="bi bi-check-circle-fill text-success me-2"></i>
                  Access mobile assessment tools
                </li>
                <li class="list-group-item">
                  <i class="bi bi-check-circle-fill text-success me-2"></i>
                  Capture and upload field data
                </li>
              {% endif %}
              
              {% if 'analyst' in roles %}
                <li class="list-group-item">
                  <i class="bi bi-check-circle-fill text-success me-2"></i>
                  Generate advanced reports and analytics
                </li>
                <li class="list-group-item">
                  <i class="bi bi-check-circle-fill text-success me-2"></i>
                  Create custom queries
                </li>
              {% endif %}
              
              {% if 'viewer' in roles or roles|length == 0 %}
                <li class="list-group-item">
                  <i class="bi bi-check-circle-fill text-success me-2"></i>
                  View basic property data
                </li>
                <li class="list-group-item">
                  <i class="bi bi-check-circle-fill text-success me-2"></i>
                  Access basic maps and reports
                </li>
              {% endif %}
            </ul>
          </div>
        </div>
      </div>
      
      <div class="card shadow">
        <div class="card-header bg-primary text-white">
          <h3 class="mb-0">Security</h3>
        </div>
        <div class="card-body">
          <a href="{{ url_for('auth.reset_password_request_route') }}" class="btn btn-outline-primary mb-3">
            <i class="bi bi-key me-2"></i>
            Change Password
          </a>
          
          <div class="alert alert-info">
            <h5><i class="bi bi-info-circle me-2"></i>Need more access?</h5>
            <p>Contact your system administrator if you need additional roles or permissions for your work.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}